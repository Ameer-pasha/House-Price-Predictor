<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>California Housing Predictor</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configure Tailwind for Inter font -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Light gray background */
        }
        /* Custom styling for better focus */
        input[type="text"]:focus, input[type="number"]:focus {
            outline: none;
            box-shadow: 0 0 0 2px #4f46e5; /* Indigo focus ring */
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <!-- Increased max-w-4xl to accommodate the wider, multi-column layout -->
    <div class="w-full max-w-4xl bg-white shadow-xl rounded-xl p-8 space-y-8">
        <!-- Title and Description -->
        <header class="text-center">
            <h1 class="text-3xl font-extrabold text-gray-900">
                California House Price Predictor
            </h1>
            <p class="mt-2 text-gray-500">
                Enter the census block characteristics below to estimate the median house value.
            </p>
        </header>

        <!-- Prediction Form -->
        <form method="POST" class="space-y-6">
            <!-- Consolidated grid: 1 column (mobile), 2 columns (tablet), 4 columns (desktop) -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">

                <!-- Input Group 1: Median Income -->
                <div>
                    <label for="MedInc" class="block text-sm font-medium text-gray-700">
                        Median Income
                    </label>
                    <div class="mt-1">
                        <input type="number" step="0.01" name="MedInc" id="MedInc" placeholder="e.g., 5.0" required
                               min="0"
                               class="numeric-positive w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out">
                    </div>
                    <p class="mt-1 text-xs text-gray-500">
                        Income of household heads (in $10,000s).
                    </p>
                </div>

                <!-- Input Group 2: House Age -->
                <div>
                    <label for="HouseAge" class="block text-sm font-medium text-gray-700">
                        House Age
                    </label>
                    <div class="mt-1">
                        <input type="number" step="0.1" name="HouseAge" id="HouseAge" placeholder="e.g., 20" required
                               min="0"
                               class="numeric-positive w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out">
                    </div>
                    <p class="mt-1 text-xs text-gray-500">
                        Median age of the housing unit (in years).
                    </p>
                </div>

                <!-- Input Group 3: Average Rooms -->
                <div>
                    <label for="AveRooms" class="block text-sm font-medium text-gray-700">
                        Avg. Rooms
                    </label>
                    <div class="mt-1">
                        <input type="number" step="0.01" name="AveRooms" id="AveRooms" placeholder="e.g., 6.0" required
                               min="0"
                               class="numeric-positive w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out">
                    </div>
                    <p class="mt-1 text-xs text-gray-500">
                        Average number of rooms per household.
                    </p>
                </div>

                <!-- Input Group 4: Average Bedrooms -->
                <div>
                    <label for="AveBedrms" class="block text-sm font-medium text-gray-700">
                        Avg. Bedrooms
                    </label>
                    <div class="mt-1">
                        <input type="number" step="0.01" name="AveBedrms" id="AveBedrms" placeholder="e.g., 1.2" required
                               min="0"
                               class="numeric-positive w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out">
                    </div>
                    <p class="mt-1 text-xs text-gray-500">
                        Average number of bedrooms per household.
                    </p>
                </div>

                <!-- Input Group 5: Population -->
                <div>
                    <label for="Population" class="block text-sm font-medium text-gray-700">
                        Population
                    </label>
                    <div class="mt-1">
                        <input type="number" step="1" name="Population" id="Population" placeholder="e.g., 1500" required
                               min="0"
                               class="numeric-positive w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out">
                    </div>
                    <p class="mt-1 text-xs text-gray-500">
                        Total population of the block group.
                    </p>
                </div>

                <!-- Input Group 6: Average Occupancy -->
                <div>
                    <label for="AveOccup" class="block text-sm font-medium text-gray-700">
                        Avg. Occupancy
                    </label>
                    <div class="mt-1">
                        <input type="number" step="0.01" name="AveOccup" id="AveOccup" placeholder="e.g., 3.0" required
                               min="0"
                               class="numeric-positive w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out">
                    </div>
                    <p class="mt-1 text-xs text-gray-500">
                        Average number of people in a house.
                    </p>
                </div>

                <!-- Input Group 7: Latitude -->
                <div>
                    <label for="Latitude" class="block text-sm font-medium text-gray-700">
                        Latitude
                    </label>
                    <div class="mt-1">
                        <input type="number" step="0.01" name="Latitude" id="Latitude" placeholder="e.g., 34.0" required value="34.0"
                               class="numeric-general w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out">
                    </div>
                    <p class="mt-1 text-xs text-gray-500">
                        North-south position of the block.
                    </p>
                </div>

                <!-- Input Group 8: Longitude -->
                <div>
                    <label for="Longitude" class="block text-sm font-medium text-gray-700">
                        Longitude
                    </label>
                    <div class="mt-1">
                        <input type="number" step="0.01" name="Longitude" id="Longitude" placeholder="e.g., -118.5" required value="-119.0"
                               class="numeric-general w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out">
                    </div>
                    <p class="mt-1 text-xs text-gray-500">
                        East-west position of the block.
                    </p>
                </div>
            </div>

            <!-- Submit Button (now directly follows the inputs) -->
            <div class="pt-6">
                <button type="submit"
                        class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-md text-lg font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-200">
                    Predict House Price
                </button>
            </div>
        </form>

        <!-- Prediction Result Display -->
        {% if prediction is not none %}
        <div id="prediction-result" class="mt-8 p-6 bg-gradient-to-br from-indigo-50 to-purple-50 border-2 border-indigo-300 rounded-xl shadow-xl">
            <h2 class="text-2xl font-bold text-indigo-900 mb-4 border-b-2 border-indigo-300 pb-2">
                üéØ Prediction Results
            </h2>

            <!-- Sanity Check Warning (using 'warning' variable from Flask) -->
            {% if warning %}
            <div class="mb-6 p-4 bg-orange-100 border-l-4 border-orange-500 text-orange-800 rounded-lg font-medium shadow-md">
                <div class="flex items-start">
                    <span class="text-2xl mr-3">‚ö†Ô∏è</span>
                    <div>
                        <strong class="font-bold">Sanity Check Warning:</strong>
                        <p class="mt-1">{{ warning }}</p>
                    </div>
                </div>
            </div>
            {% endif %}

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-start">

                <!-- Left Column: Price Result -->
                <div class="p-6 bg-white border-l-4 border-green-500 rounded-lg shadow-lg">
                    <h3 class="text-lg font-semibold text-green-800 mb-3">
                        ‚úÖ Predicted Median House Value
                    </h3>
                    <div class="mb-4">
                        <p class="text-5xl font-extrabold text-green-600">
                            ${{ '{:,.0f}'.format(prediction * 10000) }}
                        </p>
                        <p class="mt-2 text-sm text-gray-600">
                            Raw value: <span class="font-mono font-semibold">${{ prediction }}0,000</span>
                        </p>
                    </div>
                    <div class="mt-4 p-3 bg-green-50 rounded border border-green-200">
                        <p class="text-xs text-green-700">
                            <strong>Note:</strong> This represents the median house value in the specified census block group.
                        </p>
                    </div>
                </div>

                <!-- Right Column: Graph -->
                <div class="flex flex-col bg-white p-4 rounded-lg shadow-lg">
                    <h3 class="text-lg font-semibold text-gray-800 mb-3">üìä Prediction Visualization</h3>
                    <!-- Image of the Actual vs Prediction graph -->
                    <img src="{{ url_for('static', filename='actual_vs_pred.png') }}?v={{ range(1, 10000) | random }}"
                         alt="Prediction Graph"
                         class="w-full h-auto rounded-lg shadow-md border-2 border-gray-200 object-contain">
                    <p class="mt-3 text-xs text-gray-500 text-center">
                        Visual representation of the prediction accuracy
                    </p>
                </div>

            </div>
        </div>
        {% endif %}

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Function to prevent 'e', 'E', '+', and '-' keys (for positive-only fields)
            const preventScientificAndNegative = (event) => {
                const invalidKeys = ['e', 'E', '+', '-'];
                if (invalidKeys.includes(event.key)) {
                    event.preventDefault();
                }
            };

            // Function to prevent only 'e' and 'E' keys (for general numeric fields like Latitude/Longitude)
            const preventScientific = (event) => {
                const invalidKeys = ['e', 'E'];
                if (invalidKeys.includes(event.key)) {
                    event.preventDefault();
                }
            };

            // Apply validation to positive-only fields (MedInc, HouseAge, AveRooms, etc.)
            document.querySelectorAll('.numeric-positive').forEach(input => {
                input.addEventListener('keydown', preventScientificAndNegative);
                // HTML constraint for positive values
                input.setAttribute('min', '0');
            });

            // Apply validation to general numeric fields (Latitude, Longitude)
            document.querySelectorAll('.numeric-general').forEach(input => {
                input.addEventListener('keydown', preventScientific);
            });

            // Scroll to results after prediction
            {% if prediction is not none %}
            setTimeout(() => {
                document.getElementById('prediction-result').scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }, 100);
            {% endif %}
        });
    </script>
</body>
</html>
